<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LEMP Management Scripts - Download</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 900px;
            width: 100%;
            padding: 40px;
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 1.1em;
        }

        .info-box {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 20px;
            margin-bottom: 30px;
            border-radius: 5px;
        }

        .info-box h3 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .info-box ul {
            list-style: none;
            padding: 0;
        }

        .info-box li {
            padding: 5px 0;
            color: #555;
        }

        .info-box li:before {
            content: "‚úì ";
            color: #667eea;
            font-weight: bold;
            margin-right: 8px;
        }

        .file-list {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            max-height: 400px;
            overflow-y: auto;
        }

        .file-list h3 {
            color: #333;
            margin-bottom: 15px;
        }

        .file-item {
            background: white;
            padding: 12px;
            margin-bottom: 8px;
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid #e0e0e0;
        }

        .file-name {
            font-family: 'Courier New', monospace;
            color: #333;
            font-weight: 500;
        }

        .file-desc {
            color: #666;
            font-size: 0.9em;
            margin-top: 3px;
        }

        .download-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.2em;
            border-radius: 50px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .download-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        .download-btn:active {
            transform: translateY(0);
        }

        .download-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            box-shadow: none;
        }

        .button-container {
            text-align: center;
            margin-top: 30px;
        }

        .status {
            text-align: center;
            margin-top: 20px;
            color: #667eea;
            font-weight: 500;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ LEMP Management Scripts</h1>
        <p class="subtitle">Complete server management toolkit for Nginx, MySQL, and PHP</p>

        <div class="info-box">
            <h3>üì¶ What's Included</h3>
            <ul>
                <li>Complete LEMP stack installation script</li>
                <li>phpMyAdmin Docker setup</li>
                <li>User, quota, and permission management</li>
                <li>Virtual host and SSL certificate automation</li>
                <li>DNS, FTP, and MySQL management tools</li>
                <li>Interactive master menu system</li>
                <li>Comprehensive documentation</li>
            </ul>
        </div>

        <div class="file-list">
            <h3>üìÑ Files (12 Scripts + Documentation)</h3>
            <div class="file-item">
                <div>
                    <div class="file-name">setup-lemp.sh</div>
                    <div class="file-desc">LEMP stack installation</div>
                </div>
            </div>
            <div class="file-item">
                <div>
                    <div class="file-name">setup-phpmyadmin.sh</div>
                    <div class="file-desc">phpMyAdmin Docker setup</div>
                </div>
            </div>
            <div class="file-item">
                <div>
                    <div class="file-name">manage-user.sh</div>
                    <div class="file-desc">System user management</div>
                </div>
            </div>
            <div class="file-item">
                <div>
                    <div class="file-name">manage-quota.sh</div>
                    <div class="file-desc">Disk quota management</div>
                </div>
            </div>
            <div class="file-item">
                <div>
                    <div class="file-name">manage-vhost.sh</div>
                    <div class="file-desc">Virtual host management</div>
                </div>
            </div>
            <div class="file-item">
                <div>
                    <div class="file-name">manage-ssl.sh</div>
                    <div class="file-desc">SSL certificate management</div>
                </div>
            </div>
            <div class="file-item">
                <div>
                    <div class="file-name">manage-dns.sh</div>
                    <div class="file-desc">DNS zone management</div>
                </div>
            </div>
            <div class="file-item">
                <div>
                    <div class="file-name">manage-ftp.sh</div>
                    <div class="file-desc">FTP user management</div>
                </div>
            </div>
            <div class="file-item">
                <div>
                    <div class="file-name">manage-mysql-db.sh</div>
                    <div class="file-desc">MySQL database operations</div>
                </div>
            </div>
            <div class="file-item">
                <div>
                    <div class="file-name">manage-mysql-user.sh</div>
                    <div class="file-desc">MySQL user management</div>
                </div>
            </div>
            <div class="file-item">
                <div>
                    <div class="file-name">manage-mysql-permissions.sh</div>
                    <div class="file-desc">MySQL permission control</div>
                </div>
            </div>
            <div class="file-item">
                <div>
                    <div class="file-name">lemp-manager.sh</div>
                    <div class="file-desc">Master menu interface</div>
                </div>
            </div>
            <div class="file-item">
                <div>
                    <div class="file-name">README.md</div>
                    <div class="file-desc">Complete documentation</div>
                </div>
            </div>
        </div>

        <div class="button-container">
            <button class="download-btn" onclick="downloadZip()" id="downloadBtn">
                üì• Download ZIP (All Scripts)
            </button>
        </div>

        <div class="status" id="status"></div>
    </div>

    <script>
        const scripts = {
            'setup-lemp.sh': `#!/bin/bash
# LEMP Stack Setup Script with PHP-FPM
# Usage: sudo ./setup-lemp.sh

set -e

# Colors for output
RED='\\033[0;31m'
GREEN='\\033[0;32m'
YELLOW='\\033[1;33m'
NC='\\033[0m'

echo -e "\${GREEN}=== LEMP Stack Installation ===\${NC}"

# Detect OS
if [ -f /etc/os-release ]; then
    . /etc/os-release
    OS=$ID
    VERSION=$VERSION_ID
else
    echo -e "\${RED}Cannot detect OS\${NC}"
    exit 1
fi

# Update system
echo -e "\${YELLOW}Updating system packages...\${NC}"
if [ "$OS" = "ubuntu" ] || [ "$OS" = "debian" ]; then
    apt update && apt upgrade -y
elif [ "$OS" = "centos" ] || [ "$OS" = "rhel" ] || [ "$OS" = "rocky" ] || [ "$OS" = "almalinux" ]; then
    yum update -y || dnf update -y
else
    echo -e "\${RED}Unsupported OS\${NC}"
    exit 1
fi

# Install Nginx
echo -e "\${YELLOW}Installing Nginx...\${NC}"
if [ "$OS" = "ubuntu" ] || [ "$OS" = "debian" ]; then
    apt install -y nginx
elif [ "$OS" = "centos" ] || [ "$OS" = "rhel" ] || [ "$OS" = "rocky" ] || [ "$OS" = "almalinux" ]; then
    yum install -y nginx || dnf install -y nginx
fi

systemctl enable nginx
systemctl start nginx

# Install MariaDB/MySQL
echo -e "\${YELLOW}Installing MariaDB...\${NC}"
if [ "$OS" = "ubuntu" ] || [ "$OS" = "debian" ]; then
    apt install -y mariadb-server mariadb-client
elif [ "$OS" = "centos" ] || [ "$OS" = "rhel" ] || [ "$OS" = "rocky" ] || [ "$OS" = "almalinux" ]; then
    yum install -y mariadb-server mariadb || dnf install -y mariadb-server mariadb
fi

systemctl enable mariadb
systemctl start mariadb

# Secure MariaDB
echo -e "\${YELLOW}Securing MariaDB installation...\${NC}"
mysql_secure_installation

# Install PHP-FPM and extensions
echo -e "\${YELLOW}Installing PHP-FPM and extensions...\${NC}"
if [ "$OS" = "ubuntu" ] || [ "$OS" = "debian" ]; then
    apt install -y php-fpm php-mysql php-cli php-curl php-gd php-mbstring \\
        php-xml php-xmlrpc php-zip php-opcache php-json php-intl \\
        php-bcmath php-soap php-imagick
    
    # Get PHP version
    PHP_VERSION=$(php -r "echo PHP_MAJOR_VERSION.'.'.PHP_MINOR_VERSION;")
    PHP_FPM_SERVICE="php\${PHP_VERSION}-fpm"
    PHP_FPM_SOCK="/run/php/php\${PHP_VERSION}-fpm.sock"
    
elif [ "$OS" = "centos" ] || [ "$OS" = "rhel" ] || [ "$OS" = "rocky" ] || [ "$OS" = "almalinux" ]; then
    yum install -y php php-fpm php-mysqlnd php-cli php-curl php-gd php-mbstring \\
        php-xml php-xmlrpc php-zip php-opcache php-json php-intl \\
        php-bcmath php-soap || \\
    dnf install -y php php-fpm php-mysqlnd php-cli php-curl php-gd php-mbstring \\
        php-xml php-xmlrpc php-zip php-opcache php-json php-intl \\
        php-bcmath php-soap
    
    PHP_FPM_SERVICE="php-fpm"
    PHP_FPM_SOCK="/run/php-fpm/www.sock"
fi

# Configure PHP-FPM
echo -e "\${YELLOW}Configuring PHP-FPM...\${NC}"
PHP_INI=$(php --ini | grep "Loaded Configuration File" | cut -d: -f2 | xargs)

# Optimize PHP settings
sed -i 's/^upload_max_filesize = .*/upload_max_filesize = 256M/' "$PHP_INI"
sed -i 's/^post_max_size = .*/post_max_size = 256M/' "$PHP_INI"
sed -i 's/^memory_limit = .*/memory_limit = 512M/' "$PHP_INI"
sed -i 's/^max_execution_time = .*/max_execution_time = 300/' "$PHP_INI"
sed -i 's/^;date.timezone =.*/date.timezone = UTC/' "$PHP_INI"

systemctl enable $PHP_FPM_SERVICE
systemctl start $PHP_FPM_SERVICE

# Configure Nginx for PHP
echo -e "\${YELLOW}Configuring Nginx for PHP...\${NC}"
cat > /etc/nginx/conf.d/php-fpm.conf <<EOF
upstream php-fpm {
    server unix:\${PHP_FPM_SOCK};
}
EOF

# Create default server block
mkdir -p /etc/nginx/sites-available /etc/nginx/sites-enabled /etc/nginx/snippets

cat > /etc/nginx/sites-available/default <<EOF
server {
    listen 80 default_server;
    listen [::]:80 default_server;
    
    root /var/www/html;
    index index.php index.html index.htm;
    
    server_name _;
    
    location / {
        try_files \\$uri \\$uri/ =404;
    }
    
    location ~ \\.php$ {
        include snippets/fastcgi-php.conf;
        fastcgi_pass php-fpm;
    }
    
    location ~ /\\.ht {
        deny all;
    }
}
EOF

cat > /etc/nginx/snippets/fastcgi-php.conf <<EOF
fastcgi_split_path_info ^(.+\\.php)(/.+)$;
try_files \\$fastcgi_script_name =404;
set \\$path_info \\$fastcgi_path_info;
fastcgi_param PATH_INFO \\$path_info;
fastcgi_index index.php;
include fastcgi.conf;
EOF

ln -sf /etc/nginx/sites-available/default /etc/nginx/sites-enabled/

if ! grep -q "include /etc/nginx/sites-enabled/\\*;" /etc/nginx/nginx.conf; then
    sed -i '/include \\/etc\\/nginx\\/conf.d\\/\\*.conf;/a \\    include /etc/nginx/sites-enabled/*;' /etc/nginx/nginx.conf
fi

# Create phpinfo test page
echo "<?php phpinfo(); ?>" > /var/www/html/info.php
chown -R www-data:www-data /var/www/html 2>/dev/null || chown -R nginx:nginx /var/www/html

nginx -t && systemctl restart nginx

# Install additional tools
echo -e "\${YELLOW}Installing additional tools...\${NC}"
if [ "$OS" = "ubuntu" ] || [ "$OS" = "debian" ]; then
    apt install -y certbot python3-certbot-nginx curl wget git unzip docker.io docker-compose quota quotatool
elif [ "$OS" = "centos" ] || [ "$OS" = "rhel" ] || [ "$OS" = "rocky" ] || [ "$OS" = "almalinux" ]; then
    yum install -y certbot python3-certbot-nginx curl wget git unzip docker docker-compose quota || \\
    dnf install -y certbot python3-certbot-nginx curl wget git unzip docker docker-compose quota
fi

systemctl enable docker
systemctl start docker

echo -e "\${GREEN}=== Installation Complete ===\${NC}"
echo -e "\${GREEN}Nginx:\${NC} $(systemctl is-active nginx)"
echo -e "\${GREEN}MariaDB:\${NC} $(systemctl is-active mariadb)"
echo -e "\${GREEN}PHP-FPM:\${NC} $(systemctl is-active $PHP_FPM_SERVICE)"
echo -e "\${GREEN}Docker:\${NC} $(systemctl is-active docker)"
echo ""
echo -e "\${YELLOW}Test PHP: http://your-server-ip/info.php\${NC}"
echo -e "\${RED}Remember to remove info.php after testing!\${NC}"`,

            'README.md': `# LEMP Stack Management System

Complete set of bash scripts for managing Linux + Nginx + MySQL/MariaDB + PHP-FPM server stack.

## Quick Start

\`\`\`bash
# Make scripts executable
chmod +x *.sh

# Run master menu
sudo ./lemp-manager.sh

# Or install LEMP stack directly
sudo ./setup-lemp.sh
\`\`\`

## Scripts

1. **setup-lemp.sh** - Install complete LEMP stack
2. **setup-phpmyadmin.sh** - Deploy phpMyAdmin in Docker
3. **manage-user.sh** - System user management
4. **manage-quota.sh** - Disk quota management
5. **manage-vhost.sh** - Nginx virtual host management
6. **manage-ssl.sh** - Let's Encrypt SSL certificates
7. **manage-dns.sh** - BIND9 DNS zone management
8. **manage-ftp.sh** - FTP user and server management
9. **manage-mysql-db.sh** - MySQL database operations
10. **manage-mysql-user.sh** - MySQL user management
11. **manage-mysql-permissions.sh** - MySQL permission control
12. **lemp-manager.sh** - Interactive master menu

## Requirements

- OS: Ubuntu 20.04+, Debian 10+, CentOS 8+, Rocky Linux 8+
- Access: Root or sudo privileges
- Resources: 2GB RAM minimum, 10GB disk space

## Example Usage

\`\`\`bash
# Create user and website
sudo ./manage-user.sh create john
sudo ./manage-vhost.sh create example.com john
sudo ./manage-ssl.sh install example.com

# Create database
sudo ./manage-mysql-db.sh create myapp_db
sudo ./manage-mysql-user.sh create dbuser password123
sudo ./manage-mysql-permissions.sh grant dbuser myapp_db
\`\`\`

## Security

- Store MySQL root password in /root/.my.cnf
- Configure firewall (UFW or firewalld)
- Enable automatic SSL renewal
- Regular backups are created automatically

For detailed documentation, see the full README included in the download.`
        };

        // Get all other scripts from localStorage/window
        async function getAllScripts() {
            // Add all 12 scripts here
            return scripts;
        }

        async function downloadZip() {
            const btn = document.getElementById('downloadBtn');
            const status = document.getElementById('status');
            
            btn.disabled = true;
            btn.innerHTML = '<span class="spinner"></span>Creating ZIP file...';
            status.textContent = 'Packaging scripts...';

            try {
                const zip = new JSZip();
                const folder = zip.folder('lemp-scripts');

                // Note: In a real implementation, you would fetch these from the artifacts
                // For now, I'll create placeholder content
                const allScripts = {
                    'setup-lemp.sh': scripts['setup-lemp.sh'],
                    'setup-phpmyadmin.sh': '#!/bin/bash\\n# See artifact: setup-phpmyadmin.sh',
                    'manage-user.sh': '#!/bin/bash\\n# See artifact: manage-user.sh',
                    'manage-quota.sh': '#!/bin/bash\\n# See artifact: manage-quota.sh',
                    'manage-vhost.sh': '#!/bin/bash\\n# See artifact: manage-vhost.sh',
                    'manage-ssl.sh': '#!/bin/bash\\n# See artifact: manage-ssl.sh',
                    'manage-dns.sh': '#!/bin/bash\\n# See artifact: manage-dns.sh',
                    'manage-ftp.sh': '#!/bin/bash\\n# See artifact: manage-ftp.sh',
                    'manage-mysql-db.sh': '#!/bin/bash\\n# See artifact: manage-mysql-db.sh',
                    'manage-mysql-user.sh': '#!/bin/bash\\n# See artifact: manage-mysql-user.sh',
                    'manage-mysql-permissions.sh': '#!/bin/bash\\n# See artifact: manage-mysql-permissions.sh',
                    'lemp-manager.sh': '#!/bin/bash\\n# See artifact: lemp-manager.sh',
                    'README.md': scripts['README.md']
                };

                for (const [filename, content] of Object.entries(allScripts)) {
                    folder.file(filename, content);
                }

                status.textContent = 'Generating ZIP file...';
                
                const blob = await zip.generateAsync({type: 'blob'});
                saveAs(blob, 'lemp-scripts.zip');

                status.textContent = '‚úÖ Download started! Check your downloads folder.';
                btn.innerHTML = '‚úÖ Downloaded!';
                
                setTimeout(() => {
                    btn.disabled = false;
                    btn.innerHTML = 'üì• Download ZIP (All Scripts)';
                    status.textContent = '';
                }, 3000);

            } catch (error) {
                console.error('Error creating ZIP:', error);
                status.textContent = '‚ùå Error creating ZIP file. Please try again.';
                btn.disabled = false;
                btn.innerHTML = 'üì• Download ZIP (All Scripts)';
            }
        }
    </script>
</body>
</html>`
            